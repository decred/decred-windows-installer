<?xml version="1.0" encoding="utf-8"?>
<?if $(sys.BUILDARCH) = x64 ?>
  <?define ProductName = "Decred 64-bit" ?>
  <?define UpgradeCode = "39ef7dae-e91f-4fb7-b937-764d1dbdf497" ?>
  <?define PFF = "ProgramFiles64Folder" ?>
<?else ?>
  <?define ProductName = "Decred" ?>
  <?define UpgradeCode = "5dd20dd7-99cf-4170-a38c-51d9a60688bc" ?>
  <?define PFF = "ProgramFilesFolder" ?>
<?endif ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" UpgradeCode="$(var.UpgradeCode)" Name="$(var.ProductName)"
   Version="$(var.Version)" Language="1033" Manufacturer="Company 0">

    <Package Description="Decred Installer" Manufacturer="Company 0"
     Compressed="yes" InstallerVersion="200" InstallScope="perMachine"
     Platform="$(sys.BUILDARCH)" />

    <Media Id="1" Cabinet="decred.cab" EmbedCab="yes" />

    <!-- XXXX Msix64 requires windows installer 3.1 -->
    <?if $(sys.BUILDARCH) = x86 ?>
      <Condition Message="This is the 32-bit installer.  Please use the 64-bit installer.">
        <![CDATA[NOT Msix64]]>
      </Condition>
    <?endif ?>

    <MajorUpgrade DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit." />

    <!-- dir structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="$(var.PFF)">
        <!-- app suite install dir -->
        <Directory Id="APPSUITEDIR" Name="Decred">
          <!-- app install dirs -->
          <Directory Id="DCRDROOT" Name="Dcrd" />
          <Directory Id="PAYMETHEUSROOT" Name="Paymetheus" />
          <Directory Id="DCRTROOT" Name="Dcrticketbuyer" />
          <Component Id="DCRDSuiteBat">
            <File Id="dcrd.bat" Name="dcrd.bat" Source="dcrd.bat" KeyPath="yes" />
          </Component>
        </Directory>
      </Directory>
    </Directory>

    <DirectoryRef Id="TARGETDIR">
      <!-- Start Menu -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="AppProgramMenuFolder" Name="Decred">
          <!-- start menu shortcut -->
          <Component Id="DecredShortcuts" Guid="75f30a12-0956-47c5-b58c-820af5427899">
            <Shortcut Id="DecredSuite" Name="dcrd"
             Target="[%ComSpec]" Arguments='/C "[APPSUITEDIR]\dcrd.bat"'
             WorkingDirectory="APPSUITEDIR" />
            <RemoveFolder Id="AppProgramMenuFolder" On="uninstall" />
            <RegistryValue Root="HKCU" Key="SOFTWARE\Company 0\Decred"
             Name="installed" Value="1" Type="integer" KeyPath="yes" />
	  </Component>

	  <Component Id="PaymetheusShortcuts" Guid="4b253bce-3b7b-4cc0-8c6c-db1e4b4b69d6">
            <Shortcut Id="PaymetheusSuite" Name="Paymetheus"
             Target="[PAYMETHEUSROOT]\Paymetheus.exe"
             WorkingDirectory="PAYMETHEUSROOT" />
            <RegistryValue Root="HKCU" Key="SOFTWARE\Company 0\Paymetheus"
             Name="installed" Value="1" Type="integer" KeyPath="yes" />
          </Component>
	</Directory>
      </Directory>
    </DirectoryRef>

    <!-- use a stock dialog set -->
    <Property Id="WIXUI_INSTALLDIR" Value="APPSUITEDIR" />
    <UI>
      <UIRef Id="WixUI_FeatureTree" />
    </UI>
    <!--
    <Icon Id="icon" SourceFile="decred.ico"/>
    <Property Id="ARPPRODUCTICON" Value="icon" />
    -->
    <WixVariable Id="WixUILicenseRtf" Value="license.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="banner.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="dialog.bmp" />

    <!-- features -->
    <Feature Id="Dcrd" Title="Dcrd (Chain Services)" Level="1" AllowAdvertise="no"
     Description="Dcrd downloads and keeps you in sync with the Decred block chain and provides backend chain services for dcrwallet.">
      <ComponentGroupRef Id="DCRDCore" />
      <ComponentRef Id="DCRDSuiteBat" />
      <ComponentRef Id="DecredShortcuts" />
      <!-- <ComponentRef Id="DCRDConf" /> -->
    </Feature>
    <Feature Id="Paymetheus" Title="Paymetheus (Wallet)" Level="1"  AllowAdvertise="no"
     Description="Paymetheus is the native Windows Decred wallet.">
      <ComponentGroupRef Id="PaymetheusCore" />
      <ComponentRef Id="PaymetheusShortcuts" />
      <!-- <ComponentRef Id="DCRWConf" /> -->
    </Feature>
    <Feature Id="Dcrticketbuyer" Title="Dcrticketbuyer (Ticket Buyer)" Level="1"  AllowAdvertise="no"
     Description="Dcrticketbuyer is a service + web GUI to buy tickets.">
      <ComponentGroupRef Id="DCRTicketbuyerCore" />
      <!-- <ComponentRef Id="DCRTConf" /> -->
    </Feature>
  </Product>
</Wix>
